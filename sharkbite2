local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Sharkbite 2",
    LoadingTitle = "Sharkbite 2 whatever",
    LoadingSubtitle = "by mafuyu",
    Theme = "Default",
    ToggleUIKeybind = "K",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = nil,
        FileName = "SharkConfig"
    },
    Discord = {
        Enabled = false,
        Invite = "",
        RememberJoins = true
    },
    KeySystem = false
})

local Tab = Window:CreateTab("Main", 4483362458)

local remote = nil
local player = game.Players.LocalPlayer
local backpack = player:WaitForChild("Backpack")
local character = player.Character or player.CharacterAdded:Wait()
local sharkName = nil
local remotesFolder = game:GetService("ReplicatedStorage"):WaitForChild("Projectiles"):WaitForChild("Events"):WaitForChild("Weapons"):WaitForChild("remotes")

local function hookRemote(remoteObject)
    local mt = getrawmetatable(game)
    setreadonly(mt, false)
    local oldNamecall = mt.__namecall
    mt.__namecall = newcclosure(function(self, ...)
        local method = getnamecallmethod()
        if self == remoteObject and (method == "FireServer" or method == "InvokeServer") then
            remote = self.Name
        end
        return oldNamecall(self, ...)
    end)
end

for _, child in ipairs(remotesFolder:GetChildren()) do
    if child:IsA("RemoteEvent") or child:IsA("RemoteFunction") then
        hookRemote(child)
    end
end

remotesFolder.ChildAdded:Connect(function(child)
    if child:IsA("RemoteEvent") or child:IsA("RemoteFunction") then
        hookRemote(child)
    end
end)

local function getShark()
    local sharksFolder = workspace:FindFirstChild("Sharks")
    if sharksFolder then
        for _, shark in ipairs(sharksFolder:GetChildren()) do
            if shark:IsA("Model") then
                sharkName = shark.Name
                return
            end
        end
    end
    sharkName = nil
end

local function KillShark()
    for _, tool in ipairs(backpack:GetChildren()) do
        if tool:IsA("Tool") then
            tool.Parent = character
        end
    end
    for j = 1, 40 do
        if sharkName and remote then
            local shark = workspace:WaitForChild("Sharks"):FindFirstChild(sharkName)
            game:GetService("ReplicatedStorage")
                :WaitForChild("Projectiles")
                :WaitForChild("Events")
                :WaitForChild("Weapons")
                :WaitForChild("remotes")
                :WaitForChild(remote):FireServer(shark)
        end
    end
end

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local center = Vector3.new(0, 0, 0)
local radius = 1000
local speed = 2
local angle = 0
local hrp

local function updateHRP()
    character = player.Character or player.CharacterAdded:Wait()
    backpack = player:WaitForChild("Backpack")
    hrp = character:WaitForChild("HumanoidRootPart")
end

player.CharacterAdded:Connect(updateHRP)
if player.Character then updateHRP() end

local runningConnection
local Toggle

Toggle = Tab:CreateToggle({
    Name = "Autofarm [Shoot shark once to enable]",
    CurrentValue = false,
    Flag = "AutoKillShark",
    Callback = function(on)
        if on then
            local lastNotify = 0
            runningConnection = RunService.Heartbeat:Connect(function(dt)
                if not remote then
                    if tick() - lastNotify >= 3 then
                        Rayfield:Notify({
                            Title = "Waiting for shark to be shot",
                            Content = "Shoot shark to enable autofarm",
                            Duration = 3
                        })
                        lastNotify = tick()
                    end
                    return
                end
                KillShark()
                getShark()
                if not hrp or not remote then return end
                local chinook = workspace:FindFirstChild("Chinook")
                local interior = chinook and chinook:FindFirstChild("interior")
                if interior and not sharkName then
                    hrp.CFrame = interior.CFrame
                elseif sharkName then
                    angle += speed * dt
                    local offset = Vector3.new(math.cos(angle), 0, math.sin(angle)) * radius
                    hrp.CFrame = CFrame.new(center + offset, center)
                end
            end)
            player.CharacterAdded:Connect(function()
                task.wait(1)
                updateHRP()
            end)
        else
            if runningConnection then
                runningConnection:Disconnect()
                runningConnection = nil
            end
        end
    end,
})

local AutoWinConnection

local function getNearestAliveSurvivor()
    local nearestPlayer = nil
    local nearestDist = math.huge
    local myPos = hrp and hrp.Position or Vector3.zero
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= player and plr.Team and plr.Team.Name == "Survivor" then
            local char = plr.Character
            local humanoid = char and char:FindFirstChild("Humanoid")
            local hrpTarget = char and char:FindFirstChild("HumanoidRootPart")
            if humanoid and humanoid.Health > 0 and hrpTarget then
                local dist = (hrpTarget.Position - myPos).Magnitude
                if dist < nearestDist then
                    nearestDist = dist
                    nearestPlayer = plr
                end
            end
        end
    end
    return nearestPlayer
end

Tab:CreateToggle({
    Name = "Auto win as shark",
    CurrentValue = false,
    Flag = "AutoWinShark",
    Callback = function(state)
        if state then
            AutoWinConnection = RunService.Heartbeat:Connect(function()
                if player.Team and player.Team.Name == "Shark" and hrp then
                    local targetPlayer = getNearestAliveSurvivor()
                    if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                        local targetPos = targetPlayer.Character.HumanoidRootPart.Position
                        local sharksFolder = workspace:WaitForChild("Sharks")
                        for _, shark in ipairs(sharksFolder:GetChildren()) do
                            for _, part in ipairs(shark:GetDescendants()) do
                                if part:IsA("BasePart") and part.Name == "Ball" then
                                    part.CFrame = CFrame.new(targetPos)
                                end
                            end
                        end
                    end
                end
            end)
            player.CharacterAdded:Connect(function()
                task.wait(1)
                updateHRP()
            end)
        else
            if AutoWinConnection then
                AutoWinConnection:Disconnect()
                AutoWinConnection = nil
            end
        end
    end
})

local sharkESPConnection = {}
local function setSharkESP(enabled)
    local sharksFolder = workspace:FindFirstChild("Sharks")
    if not sharksFolder then return end
    for _, conn in ipairs(sharkESPConnection) do
        conn:Disconnect()
    end
    table.clear(sharkESPConnection)
    for _, shark in ipairs(sharksFolder:GetDescendants()) do
        if shark:IsA("Highlight") then
            if enabled then
                shark.Enabled = true
                shark.OutlineTransparency = 0
                table.insert(sharkESPConnection, shark:GetPropertyChangedSignal("Enabled"):Connect(function()
                    if not shark.Enabled then
                        shark.Enabled = true
                    end
                end))
                table.insert(sharkESPConnection, shark:GetPropertyChangedSignal("OutlineTransparency"):Connect(function()
                    if shark.OutlineTransparency ~= 0 then
                        shark.OutlineTransparency = 0
                    end
                end))
            else
                shark.Enabled = false
                shark.OutlineTransparency = 1
                table.insert(sharkESPConnection, shark:GetPropertyChangedSignal("Enabled"):Connect(function()
                    if shark.Enabled then
                        shark.Enabled = false
                    end
                end))
                table.insert(sharkESPConnection, shark:GetPropertyChangedSignal("OutlineTransparency"):Connect(function()
                    if shark.OutlineTransparency ~= 1 then
                        shark.OutlineTransparency = 1
                    end
                end))
            end
        end
    end
end

local function watchForNewSharks(toggleState)
    local sharksFolder = workspace:FindFirstChild("Sharks")
    if sharksFolder then
        table.insert(sharkESPConnection, sharksFolder.DescendantAdded:Connect(function(desc)
            if desc:IsA("Highlight") then
                setSharkESP(toggleState)
            end
        end))
    end
end

Tab:CreateToggle({
    Name = "Highlight sharks [ESP]",
    CurrentValue = false,
    Flag = "SharkESP",
    Callback = function(state)
        setSharkESP(state)
        watchForNewSharks(state)
    end
})
